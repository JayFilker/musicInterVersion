================================================================================
React 音乐播放器 - 详情页播放功能实现分析
================================================================================


【关键文件路径】

1. 播放列表详情页：
   - src/pages/PlaysList/index.tsx (主页面)
   - src/pages/PlaysList/PlayListInfo/index.tsx (头部信息组件)

2. 艺人详情页：
   - src/pages/Artist/index.tsx (主页面)
   - src/pages/Artist/ArtistInfo/index.tsx (艺人信息组件)

3. 歌曲列表组件：
   - src/components/TrackList/index.tsx
   - src/components/TrackList/TrackListItem/index.tsx
   - src/components/TrackList/TrackListDemo/index.tsx
   - src/components/Track/index.tsx
   - src/components/TrackItem/index.tsx

4. 状态和事件：
   - src/store/store.ts (Jotai 原子)
   - src/utils/eventBus.ts (事件总线)
   - src/api/check.ts (API 数据获取)

【歌曲列表渲染方式】

播放列表/专辑页：
  TrackList 接收 songListInfo prop → map 遍历 items 数组 → 为每个歌曲渲染 TrackListItem
  
艺人页面：
  Track 接收 tracks prop → map 遍历 items 数组 → 为每个歌曲渲染 TrackItem (网格4列)
  TrackListDemo 用于其他场景的歌曲展示

【播放功能的核心实现】

双击歌曲播放 (TrackListItem):
  onDoubleClick handler 执行：
  1. 创建布尔数组标记当前歌曲为播放状态
  2. 调用 setPlayingTrack() 更新 Jotai 原子
  3. 发送 eventBus.emit('playList-playing', {...}) 事件
  4. 样式自动更新为 .playing 类

头部播放按钮 (PlayListInfo/ArtistInfo):
  onClick handler 执行：
  1. 设置状态原子 (PlayingTrack 或 Playing)
  2. 标记第一首歌为播放状态
  3. 发送相应的播放事件到事件总线

艺人页面热门歌曲双击 (TrackItem):
  onDoubleClick handler 执行：
  1. 更新 CurrentSongList 原子（当前歌曲列表）
  2. 更新 CountDemo 原子（当前歌曲索引）
  3. 发送 eventBus.emit('play-track', track.uri) 事件
  4. 标记首次播放完成

【关键代码片段】

PlayListInfo 头部播放按钮 (第117-128行):
  eventBus.emit('playList-playing', {
      e, id, img, check: type === 'playlists'
  })
  setPlayingTrack(demo where demo[0] = true)

TrackListItem 双击播放 (第30-42行):
  onDoubleClick: emit 'playList-playing' with count: index
  setPlayingTrack(demo where demo[index] = true)

TrackItem 双击播放 (第33-39行):
  onDoubleClick: setCurrentSong, setCount(index)
  emit 'play-track' with track.uri

ArtistInfo 头部播放按钮 (第59-76行):
  setCurrentSong, setCount(0)
  emit 'play-track' with hotSongs?.tracks[0].uri

【状态管理】

Jotai 原子 (store/store.ts):
  - PlayingTrack: 布尔数组，标记播放列表/专辑中的播放状态
  - Playing: 布尔数组，标记艺人页面的播放状态
  - CurrentSongList: {items: Array, imgPic: string} 当前歌曲列表
  - CountDemo: 当前播放的歌曲索引 (0-based)
  - FirstPlay/IsPlayingDemoTwo: 播放标记
  - BadLike/Link: 其他状态

【事件总线】

eventBus.ts 定义了两个关键事件：
  1. 'playList-playing': {e, id, img, check, count?}
     用于播放列表/专辑详情页的播放事件

  2. 'play-track': Spotify URI 字符串
     用于艺人页面和歌曲演示项的播放事件

【CSS 样式】

TrackListItem 样式类:
  .track - 基础行样式
  .playing - 播放状态（背景高亮，文字高亮）
  .focus - 鼠标悬停状态（背景浅色）
  .playlist - 播放列表模式（显示专辑图）
  .album - 专辑模式（显示序号）

样式切换逻辑:
  className = 
    track 
    + (type === 'playlists' ? 'playlist' : 'album')
    + (showRow ? 'focus' : '')
    + (playingTrack[index] ? 'playing' : '')

【API 数据获取】

usePlaysList(type, id):
  获取播放列表/专辑基本信息
  调用: get(/playlists/id) 或 get(/albums/id)

useInternalInit(id, check):
  获取完整歌曲列表
  调用: get(/playlists/id/tracks) 或 get(/albums/id/tracks)
  缓存: 5分钟

【播放流程总结】

播放列表/专辑:
  用户操作 → TrackListItem 双击或 PlayListInfo 点击
  → emit 'playList-playing'
  → PlayingTrack 原子更新
  → UI 样式变化 (.playing 类)

艺人页面:
  用户操作 → TrackItem 双击或 ArtistInfo 点击
  → setCurrentSong + setCount + emit 'play-track'
  → Playing 原子更新
  → UI 样式变化 (.track-playing 类)

【交互方式】

- 双击歌曲项: 播放该歌曲
- 单击头部播放按钮: 从第一首开始播放全列表
- 鼠标悬停: 显示播放控制图标
- 点击悬停时的图标: 触发相应操作（收藏等）

【注意事项】

1. 播放列表和艺人页面使用不同的状态原子：
   - PlayingTrack 对应 playingTrack[index] 布尔值
   - Playing 对应 play[index] 布尔值

2. 列表项的 CSS 类通过计算属性动态生成，可以同时包含多个类

3. 事件总线采用 mitt 库，轻量级且高效

4. 所有数据通过 React Query 缓存，避免重复请求

5. 响应式设计：手机端和桌面端共享同一套组件


